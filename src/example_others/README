From hier_s2p and cmd_t2p_conv (Shubham's code)
